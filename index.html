<!DOCTYPE html>
<html lang="en" id="oranda" class="dark">
  <head>
    <title>syncthing-task-resolve</title>
    
      <meta property="og:url" content="https://github.com/adam-gaia/syncthing-task-resolve" />
    
    
      <link rel="icon" href="/favicon.ico" />
    
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
      <meta name="description" content="Resolve syncthing conflicts for taskwarrior databases" />
      <meta property="og:description" content="Resolve syncthing conflicts for taskwarrior databases" />
    
    <meta property="og:type" content="website" />
    <meta property="og:title" content="syncthing-task-resolve" />
    
    
    
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()" />
    <link rel="stylesheet" href="/oranda-v0.6.1.css" />
    
    
  </head>
  <body>
    <div class="container">
      <div class="page-body">
        
          <div class="repo_banner">
            <a href="https://github.com/adam-gaia/syncthing-task-resolve">
              <div class="github-icon" aria-hidden="true"></div>
              Check out our GitHub!
            </a>
          </div>
        

        <main>
          <header>
            
            <h1 class="title">syncthing-task-resolve</h1>
            
  <nav class="nav">
    <ul>
      <li><a href="/">Home</a></li>

      

      

      

      

      
        <li><a href="/changelog/">Changelog</a></li>
      
    </ul>
  </nav>

          </header>

          


    <h1>syncthing-task-resolve</h1>
<p>Resolve conflicts from syncing taskwarrior (taskchampion.sqlite3) databases with syncthing</p>
<h2>What is this crate for?</h2>
<h3>TL;DR</h3>
<p>With two iOS apps ($5 each, not open source), and this rust crate (free and open source), one can sync taskwarrior tasks between linux machines and iPhone/iPads.</p>
<h3>The Problem</h3>
<p>I use <a href="https://taskwarrior.org/" rel="noopener noreferrer">taskwarrior</a> for managing my todo lists on my <strong>linux</strong> laptop.</p>
<p>I also have an iPhone. It's probably obvious, but getting my taskwarrior tasks on my iPhone is not easy;
Either I should get an android phone or develop my own IOS taskwarrior app.
Since both would be a big effort and its not clear which will happen first, if at all, I've elected for a band-aid solution.</p>
<h3>The Band-aid Solution</h3>
<p>I have two apps that make working with taskwarrior tasks on IOS possible.</p>
<p>The first is <a href="https://github.com/marriagav/taskchamp-docs" rel="noopener noreferrer">Taskchamp</a>. Not to be confused with <a href="https://github.com/GothenburgBitFactory/taskchampion" rel="noopener noreferrer">taskchampion</a>, taskwarrior v3's sync backend.
Taskchamp's main is that one can easily sync the taskwarrior database between an iPhone and a Mac via iCloud.
I'm sure that all works great, but I just sold my macbook a few months ago in favor of running linux full time on a framework laptop (go get 'em <em>champ</em>!).</p>
<p>For syncing iOS &lt;-&gt; linux, I use <a href="https://mobiussync.com/" rel="noopener noreferrer">Mobius Sync</a>, a <a href="https://syncthing.net/" rel="noopener noreferrer">syncthing</a> client for iOS.
This app (the $5 paid version) has the ability to sync files in other apps file sandboxes,
which many (well probably at least a dozen lol) people use to sync their [Obsidan] vaults to iOS devices without Obsidian's monthly subscription.
I checked it out for that use case, and figured it would work with syncing taskwarrior data as well.</p>
<p>Unfortunately, neither app is fully open source.</p>
<p>Syncing this way worked pretty well out of the box... with one pretty major issue.</p>
<h4>Problems caused by the solution</h4>
<p>The version of the database on my linux machine constantly overrides the version on my iPhone.
I believe this must be because Taskwarrior <em>modifies</em> the database each time it is accessed. I haven't looked into the internals of taskwarrior, but
this is consistent with <a href="https://docs.syncthing.net/users/syncing.html#conflicting-changes" rel="noopener noreferrer">Syncthing's docs on conflicting changes</a>.
When a file has been modified on two devices, syncthing takes the one with the latest modified time and calls the other a 'conflict'.</p>
<p>I've tested this and found that I lose tasks created on my iPhone when I simply run <code>task list</code> on my laptop before syncthing has had a chance to sync.
If I don't touch taskwarrior on the laptop for a few minutes (while syncthing syncs), the new tasks created on the iPhone do show up.</p>
<h4>Solutions to problems caused by the original solution</h4>
<p>Fortunately, syncthing saves the discarded version of the file conflict. These files are saved next to the override as <code>taskchampion.sync-conflict-&lt;timestamp&gt;-&lt;originating device&gt;.sqlite3</code>.
I've written a simple program (this repo's rust crate) to merge the taskwarrior database syncthing conflicts.
By running this tool periodically, conflicts are resolved and sync behavior works as expected.</p>
<h2>Disclaimer</h2>
<p>I've been using this setup for a while now and haven't had any problems. But of course, this is a band-aid for a hacky, unsupported process.
Yada yada yada, use at your own risk!</p>
<h2>Usage</h2>
<ul>
<li>Standalone</li>
</ul>
<pre style="background-color:#263238;"><span style="color:#eeffff;">$ syncthing-task-resolve
</span></pre>

<ul>
<li>
<p>As a taskwarrior hook
TODO: write up how to set up to run whenever we run 'task'</p>
</li>
<li>
<p>With a file watcher
TODO: add notes on running whenever a syncthing conflict file is created</p>
</li>
</ul>
<h2>Configuration</h2>
<p>TODO: add notes on config</p>



        </main>
      </div>

      <footer>
        
          <a href="https://github.com/adam-gaia/syncthing-task-resolve"><div class="github-icon" aria-hidden="true"></div></a>
        
        <span>
          syncthing-task-resolve, MIT OR Apache-2.0
        </span>
      </footer>
    </div>

    
    

    


  </body>
</html>